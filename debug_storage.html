<!DOCTYPE html>
<html>
<head>
    <title>Storage Debug - Robotech Store</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .debug-section { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .storage-item { background: white; padding: 10px; margin: 5px 0; border-left: 4px solid #007bff; }
        .error { border-left-color: #dc3545; }
        .success { border-left-color: #28a745; }
        .btn { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #0056b3; }
        .clear-btn { background: #dc3545; }
        .clear-btn:hover { background: #c82333; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç Browser Storage Debug Tool</h1>
    <p>This tool shows exactly what's stored in your browser for the Robotech Store login system.</p>

    <div class="debug-section">
        <h3>Session Storage</h3>
        <div id="sessionStorage"></div>
    </div>

    <div class="debug-section">
        <h3>Local Storage</h3>
        <div id="localStorage"></div>
    </div>

    <div class="debug-section">
        <h3>Analysis</h3>
        <div id="analysis"></div>
    </div>

    <div class="debug-section">
        <h3>Actions</h3>
        <button class="btn" onclick="refreshData()">üîÑ Refresh Data</button>
        <button class="btn clear-btn" onclick="clearAllData()">üóëÔ∏è Clear All Login Data</button>
        <button class="btn" onclick="testLogin()">üß™ Test Login</button>
        <a href="static_index.html" class="btn">üè† Back to Store</a>
    </div>

    <div class="debug-section">
        <h3>Console Output</h3>
        <pre id="consoleOutput"></pre>
    </div>

    <script>
        let consoleMessages = [];

        // Override console.log to capture messages
        const originalLog = console.log;
        console.log = function(...args) {
            consoleMessages.push('[LOG] ' + args.join(' '));
            originalLog.apply(console, args);
            updateConsole();
        };

        const originalError = console.error;
        console.error = function(...args) {
            consoleMessages.push('[ERROR] ' + args.join(' '));
            originalError.apply(console, args);
            updateConsole();
        };

        function updateConsole() {
            document.getElementById('consoleOutput').textContent =
                consoleMessages.slice(-10).join('\n'); // Show last 10 messages
        }

        function refreshData() {
            console.log('Refreshing storage data...');
            displayStorageData();
            analyzeData();
        }

        function displayStorageData() {
            // Session Storage
            const sessionDiv = document.getElementById('sessionStorage');
            sessionDiv.innerHTML = '';

            for (let i = 0; i < sessionStorage.length; i++) {
                const key = sessionStorage.key(i);
                const value = sessionStorage.getItem(key);
                const isValid = key.includes('user_id') ? !isNaN(parseInt(value)) && parseInt(value) > 0 : true;
                sessionDiv.innerHTML += `<div class="storage-item ${isValid ? 'success' : 'error'}">
                    <strong>${key}:</strong> "${value}" (${typeof value})
                </div>`;
            }

            if (sessionStorage.length === 0) {
                sessionDiv.innerHTML = '<div class="storage-item">No session storage data</div>';
            }

            // Local Storage
            const localDiv = document.getElementById('localStorage');
            localDiv.innerHTML = '';

            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                const isValid = key.includes('user_id') ? !isNaN(parseInt(value)) && parseInt(value) > 0 : true;
                localDiv.innerHTML += `<div class="storage-item ${isValid ? 'success' : 'error'}">
                    <strong>${key}:</strong> "${value}" (${typeof value})
                </div>`;
            }

            if (localStorage.length === 0) {
                localDiv.innerHTML = '<div class="storage-item">No local storage data</div>';
            }
        }

        function analyzeData() {
            const analysisDiv = document.getElementById('analysis');
            let analysis = '';

            const sessionUserId = sessionStorage.getItem('user_id');
            const localUserId = localStorage.getItem('user_id');
            const sessionLoggedIn = sessionStorage.getItem('logged_in');
            const localLoggedIn = localStorage.getItem('logged_in');

            analysis += '<h4>Login Data Analysis:</h4>';

            // Check user_id
            if (sessionUserId || localUserId) {
                const userId = sessionUserId || localUserId;
                const parsedId = parseInt(userId);
                if (isNaN(parsedId) || parsedId <= 0) {
                    analysis += `<p class="error">‚ùå INVALID USER ID: "${userId}" (should be a positive number)</p>`;
                } else {
                    analysis += `<p class="success">‚úÖ VALID USER ID: ${parsedId}</p>`;
                }
            } else {
                analysis += '<p>‚ÑπÔ∏è No user ID found</p>';
            }

            // Check login status
            if (sessionLoggedIn || localLoggedIn) {
                const loggedIn = sessionLoggedIn || localLoggedIn;
                if (loggedIn === 'true') {
                    analysis += '<p class="success">‚úÖ User is logged in</p>';
                } else {
                    analysis += '<p class="error">‚ùå Login status is not "true"</p>';
                }
            } else {
                analysis += '<p>‚ÑπÔ∏è No login status found</p>';
            }

            // Check for corrupted data
            let corruptedFound = false;
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                if (value === 'NaN' || value === 'null' || value === 'undefined') {
                    analysis += `<p class="error">‚ùå CORRUPTED DATA FOUND: ${key} = "${value}"</p>`;
                    corruptedFound = true;
                }
            }

            if (!corruptedFound) {
                analysis += '<p class="success">‚úÖ No corrupted data detected</p>';
            }

            analysisDiv.innerHTML = analysis;
        }

        function clearAllData() {
            if (confirm('This will clear ALL login data and cart data. Continue?')) {
                console.log('Clearing all login data...');

                // Clear login data
                sessionStorage.removeItem('user_id');
                sessionStorage.removeItem('phone');
                sessionStorage.removeItem('logged_in');
                localStorage.removeItem('user_id');
                localStorage.removeItem('phone');
                localStorage.removeItem('logged_in');

                // Clear cart data
                for (let i = localStorage.length - 1; i >= 0; i--) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('demo_cart_')) {
                        localStorage.removeItem(key);
                    }
                }

                console.log('All data cleared');
                alert('All login and cart data cleared! Please refresh the page.');
                refreshData();
            }
        }

        function testLogin() {
            console.log('Testing login functionality...');

            // Generate test user ID
            const testUserId = Math.floor(Math.random() * 9000) + 1000;
            const testPhone = '9876543210';

            // Store test data
            sessionStorage.setItem('user_id', testUserId.toString());
            sessionStorage.setItem('phone', testPhone);
            sessionStorage.setItem('logged_in', 'true');

            localStorage.setItem('user_id', testUserId.toString());
            localStorage.setItem('phone', testPhone);
            localStorage.setItem('logged_in', 'true');

            console.log('Test login data stored:', { user_id: testUserId, phone: testPhone });
            alert(`Test login created!\nUser ID: ${testUserId}\nPhone: ${testPhone}`);

            refreshData();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Debug page loaded');
            refreshData();
        });
    </script>
</body>
</html>
